#######################################################################
# Batch running                                                       #
#######################################################################

BatchTestBench {

  preRunScript = "/proj/GROUP_NAME/exp/EXPERIMENT_NAME/setup/prerun-scripts/restart-cluster.sh"
  preRunOutputFile = "/proj/GROUP_NAME/exp/EXPERIMENT_NAME/setup/benchmarks/prerun-script.out"

  Bookkeeper {
    basePath = "/proj/GROUP_NAME/exp/EXPERIMENT_NAME/setup/benchmarks/output/batch"
  }

  defaultConfig {
    MergedMapTestBench {
      #Number of maps used for the test
      numberOfMaps = 1
      #Write rate in entries per second, needs to be divisable by (1000/writeInterval)
      writeRate = 100
      #Interval in milliseconds
      writeInterval = 10
      #Warmup
      numberOfWarmupWrites = 1000
      #Number of writes for the benchmark
      benchMarkWrites = 6000
      #Number of readers per map
      readersPerMap = 1
      #Name of the test map, empty for auto generated name
      mapName = ""
      #Sizee of the table
      tableSize = 1000
    }
    MultiMergedMapTestBench {
      #Number of maps used for the test
      numberOfMaps = 1
      #Write rate in entries per second per map
      writeRatePerMap = 10
      #Number of maps per writer
      maxNumberOfMapsPerWriter = 10
      #Number of maps per reader
      maxNumberOfMapsPerReader = 10
      #Warmup
      warmupWrites = 1000
      #Number of writes for the benchmark
      benchMarkWrites = 3000
      #Name of the test map, empty for auto generated name
      mapName = ""
      #Sizee of the table
      tableSize = 1000
      #Delay for each node before it starts writing, to avoid spikes [microseconds]
      initialDelay=100
    }
  }

  runs = [
    {
      #RUN 1
      bench = MergedMapTestBench
      MergedMapTestBench {
        #Modifying one parameter for this run
        readersPerMap = 1
      }
    },
    # Cluster is restarted in between runs, using the prerun scripts
    {
      #RUN 2
      bench = MergedMapTestBench
      MergedMapTestBench {
        #Modifying one parameter for this run
        readersPerMap = 10
      }
    },
    # Cluster is restarted in between runs, using the prerun scripts
    {
      #RUN 3
      bench = MergedMapTestBench
      MergedMapTestBench {
        #Modifying one parameter for this run
        readersPerMap = 19
      }
    }
  ]

}

#######################################################################
# ALL CONFIGURATION BELOW IS FOR RUNNING THE BENCHES DIRECTLY         #
# It is recommended to use the BatchTestBench on the cluster even for #
# a single run, because without the BatchTestBench the prerun scripts #
# are not invoked.                                                    #
#######################################################################

#######################################################################
# This is the configuration for a single run of MergedMapTestBench    #
#######################################################################

MergedMapTestBench {
  #Number of maps used for the test
  numberOfMaps = 2
  #Write rate in entries per second, needs to be divisable by (1000/writeInterval)
  writeRate = 200
  #Interval in milliseconds
  writeInterval = 5
  #Warmup
  numberOfWarmupWrites = 1000
  #Number of writes for the benchmark
  benchMarkWrites = 2000
  #Number of readers per map
  readersPerMap = 1
  #Name of the test map, empty for auto generated name
  mapName = ""
  #Sizee of the table
  tableSize = 100

  Bookkeeper {
    basePath = "/path/to/output/directory"
  }
}

############################################################################
# This is the configuration for a single run of MultiMergedMapTestBench    #
############################################################################

MultiMergedMapTestBench {
  #Number of maps used for the test
  numberOfMaps = 20
  #Write rate in entries per second per map
  writeRatePerMap = 100
  #Number of maps per writer
  maxNumberOfMapsPerWriter = 10
  #Number of maps per reader
  maxNumberOfMapsPerReader = 10
  #Warmup
  warmupWrites = 1000
  #Number of writes for the benchmark
  benchMarkWrites = 6000
  #Name of the test map, empty for auto generated name
  mapName = ""
  #Sizee of the table
  tableSize = 1000
  #Delay for each node before it starts writing, to avoid spikes [microseconds]
  initialDelay=100

  Bookkeeper {
    basePath = "/path/to/output/directory"
  }
}